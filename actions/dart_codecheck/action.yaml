name: Dart Codecheck
description: Checks your Dart Code

inputs:
  working-directory:
    type: string
  dart-version:
    required: true

runs:
  using: composite
  steps:
    - name: "Setup Dart ${{ inputs.dart-version }}"
      uses: dart-lang/setup-dart@v1
      with:
        sdk: ${{ inputs.dart-version }}

    - name: "Run tests parallel"
      uses: sambacha/parallelish@v1.0.0
      id: testing-tasks
      working-directory: ${{ github.workspace }}/${{ inputs.working-directory }}
      with:
        cmd1: |
          find lib test -name "*.dart" ! -name "*.*.dart" -print0 | xargs -0 \
          dart format \
          --set-exit-if-changed \
          --line-length 120
        cmd2: |
          dart analyze \
          --fatal-infos \
          --fatal-warnings \
          --no-pub
        cmd3: |
          dart \
          --enable-vm-service \
          test \
          --file-reporter="json:${{ github.workspace }}/dart-test-report.json" \
          --concurrency=6 \
          --no-pub \
          --coverage
